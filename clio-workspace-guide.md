# Посібник з роботи з Clio Workspace

## Папка `.solution` у Workspace

### Що це таке?

`.solution` - це папка, яка створюється автоматично в кореневій директорії workspace і містить Visual Studio Solution файл (`CreatioPackages.sln`). Ця функціональність дозволяє відкривати всі пакети workspace в одному Visual Studio Solution.

### Як це працює?

**Створення:**
- При роботі з workspace, clio автоматично сканує папку `packages/` 
- Знаходить всі `.csproj` файли пакетів
- Створює `.solution/CreatioPackages.sln` з посиланнями на всі знайдені проекти
- Шляхи до проектів зберігаються як відносні від `.solution` папки

**Структура:**
```
workspace/
├── .solution/
│   └── CreatioPackages.sln    # Основний solution файл
├── packages/
│   ├── Package1/
│   │   └── Files/Package1.csproj
│   └── Package2/
│       └── Files/Package2.csproj
└── tasks/
    ├── open-solution-framework.cmd
    ├── open-solution-netcore.cmd
    └── ... інші скрипти
```

### Як працювати?

**Відкриття в Visual Studio:**
1. Використайте готові скрипти з папки `tasks/`:
   - `open-solution-framework.cmd` - для .NET Framework
   - `open-solution-netcore.cmd` - для .NET Core

**Автоматичне оновлення:**
- Solution оновлюється автоматично при додаванні нових пакетів до workspace послк виконання команди `clio restorew`
- Всі пакети з `.csproj` файлами включаються автоматично

**Переваги:**
- Всі пакети workspace в одному Solution
- Intellisense та навігація між пакетами  
- Можливість одночасного білда всіх пакетів
- Зручна робота з рефакторингом

---

## Команда `clio dconf` (download-configuration)

### Що це таке?

`clio dconf` - це скорочена назва команди `download-configuration`, яка завантажує системні бібліотеки та конфігурацію з Creatio веб-додатка в локальну папку `.application` вашого workspace.

### Як працює?

Команда завантажує наступні компоненти з Creatio:

**1. Основні системні бібліотеки:**
- **CoreBin** → `.application/[net-core|net-framework]/core-bin/`
- **Lib** → `.application/[net-core|net-framework]/Lib/`  
- **ConfigurationBin** → `.application/[net-core|net-framework]/bin/`

**2. Автогенеровані файли пакетів:**
- Автогенеровані класи для схем → `packages/[PackageName]/Autogenerated/`
- DLL файли залежностей → `.application/[net-core|net-framework]/packages/`

### Структура папки `.application`:

```
.application/
├── net-core/           # Для .NET Core проектів
│   ├── core-bin/       # Основні системні DLL
│   ├── Lib/           # Бібліотеки конфігурації
│   ├── bin/           # Виконувані файли
│   └── packages/      # DLL залежних пакетів
└── net-framework/     # Для .NET Framework проектів
    ├── core-bin/
    ├── Lib/
    ├── bin/
    └── packages/
```

### Як використовувати:

**Основне використання:**
```bash
clio dconf -e MyEnvironment
```

**З конкретними пакетами (якщо вони вказані в workspace):**
```bash
# Завантажить бібліотеки + автогенеровані файли для пакетів з workspaceSettings.json
clio dconf -e MyEnvironment
```

### Коли використовувати:

1. **Після створення workspace** - для отримання всіх необхідних системних бібліотек
2. **При оновленні Creatio** - для синхронізації з новою версією
3. **При роботі з IntelliSense** - для коректного розпізнавання системних класів
4. **Перед білдом проектів** - щоб мати всі необхідні залежності

### Важливо:

- Команда працює тільки всередині workspace
- Потребує активного з'єднання з Creatio
- Автоматично визначає тип проекту (.NET Core/.NET Framework)
- Завантажує тільки ті пакети, які вказані в `workspaceSettings.json`

---

## Команда `clio restorew` (restore-workspace)

### Що це таке?

`clio restorew` - це команда для відновлення існуючого workspace. Вона завантажує пакети з сервера, відновлює NuGet пакети, створює solution файли та налаштовує робоче середовище.

### Як працює?

Команда виконує наступні дії:
1. **Перевіряє існування workspace** - якщо workspace не існує, автоматично створює новий
2. **Завантажує пакети** з сервера згідно з `workspaceSettings.json`
3. **Відновлює NuGet пакети** (якщо `IsNugetRestore = true`)
4. **Створює solution файли** (якщо `IsCreateSolution = true`)
5. **Налаштовує структуру папок** та конфігураційні файли

### Використання:

```bash
# Базове відновлення
clio restorew -e MyEnvironment

# З додатковими параметрами
clio restorew -e MyEnvironment --IsNugetRestore false --IsCreateSolution true
```

### Коли використовувати:

- **Після клонування репозиторію** з існуючим workspace
- **При переключенні між гілками** з різними конфігураціями пакетів
- **Для синхронізації** з сервером після змін у `workspaceSettings.json`
- **При виникненні проблем** з локальним workspace

---

## Скрипти відкриття Solution

### ⚠️ ВАЖЛИВО: Ніколи не відкривайте solution файли безпосередньо!

**Завжди використовуйте скрипти з папки `tasks/`**, оскільки вони налаштовують критично важливі змінні середовища, які використовуються `.csproj` файлами.

### Основні Solution скрипти:

**Для розробки пакетів:**
- `open-solution-netcore.cmd` - .NET Core без SDK
- `open-solution-netcore-sdk.cmd` - .NET Core з Creatio SDK
- `open-solution-framework.cmd` - .NET Framework без SDK  
- `open-solution-framework-sdk.cmd` - .NET Framework з Creatio SDK

**Для Unit тестів:**
- `open-test-solution-netcore.cmd` - відкриває `tests/UnitTests.sln`
- `open-test-solution-framework.cmd` - відкриває `tests/UnitTests.sln`

### Різниця між варіантами:

**Без SDK (`open-solution-netcore.cmd`):**
```cmd
set CoreLibPath=..\..\..\.application\net-core\core-bin
set RelativePkgFolderPath=..\..\..\.application\net-core\packages
set CoreTargetFramework=netstandard2.0
START ..\.solution\CreatioPackages.sln
```

**З SDK (`open-solution-netcore-sdk.cmd`):**
```cmd
call ..\.solution\set-netcore-environment.cmd
START ..\.solution\CreatioPackages.sln
```

- **Без SDK**: Використовує локальні DLL з `.application` папки
- **З SDK**: Використовує NuGet пакети Creatio SDK з офіційного репозиторію

### Unit Test Solution

Clio може створювати окремий solution для Unit тестів:

**Створення:**
```bash
clio create-test-project -e MyEnvironment
```

**Структура:**
```
tests/
├── UnitTests.sln           # Solution для тестів
├── PackageName1/
│   ├── PackageName1.Tests.csproj
│   └── Libs/              # Тестові бібліотеки
└── PackageName2/
    ├── PackageName2.Tests.csproj
    └── Libs/
```

**Відкриття:**
- `open-test-solution-netcore.cmd`
- `open-test-solution-framework.cmd`

---

## Загальний workflow роботи з workspace

1. **Створення workspace:**
   ```bash
   clio createw -e MyEnvironment
   ```
2**Завантаження системних бібліотек:**
   ```bash
   clio dconf -e MyEnvironment
   ```

3**Відновлення workspace (при роботі з існуючим):**
   ```bash
   clio restorew -e MyEnvironment
   ```

4. **Відкриття в Visual Studio:**
   ```bash
   # ⚠️ ЗАВЖДИ використовуйте скрипти з tasks/!
   # Для основної розробки:
   tasks/open-solution-netcore.cmd
   
   # Для Unit тестів (якщо створені):
   tasks/open-test-solution-netcore.cmd
   ```

5. **Розробка** з повним IntelliSense та навігацією між пакетами

6. **Публікація змін:**
   ```bash
   clio pushw -e MyEnvironment
   ```

### Критично важливі правила:

- ⚠️ **НІКОЛИ** не відкривайте `.sln` файли безпосередньо через File Explorer або VS
- ✅ **ЗАВЖДИ** використовуйте скрипти з папки `tasks/`
- ✅ Скрипти налаштовують змінні середовища, без яких проекти не працюватимуть коректно
- ✅ Використовуйте `-sdk` варіанти для стабільної розробки з офіційними NuGet пакетами

Ці функціональності роблять розробку в Creatio значно зручнішою, надаючи потужні інструменти для роботи з кодом та управління залежностями.