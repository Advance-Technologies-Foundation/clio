# Deploy Infrastructure Force Recreate - Implementation Summary

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ó–ê–í–ï–†–®–ï–ù–û

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è Kubernetes namespace –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ K8S —Å–µ—Ä–≤–∏—Å–æ–≤ (—ç—Ç–∞–ø 1)

**–§–∞–π–ª:** `clio/Common/K8/k8Commands.cs`

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Ik8Commands`:
- `bool NamespaceExists(string namespaceName)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è namespace
- `bool DeleteNamespace(string namespaceName)` - —É–¥–∞–ª–µ–Ω–∏–µ namespace —Å–æ –≤—Å–µ–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º

‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ–±–∞ –º–µ—Ç–æ–¥–∞ –≤ –∫–ª–∞—Å—Å–µ `k8Commands`:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `IKubernetes` –∫–ª–∏–µ–Ω—Ç –∏–∑ k8s –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP 404 –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–≥—Ä–∞—É–Ω–¥ —É–¥–∞–ª–µ–Ω–∏—è —Å —Ç–∞–π–º–∞—É—Ç–æ–º –Ω–∞ graceful shutdown
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º boolean —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

---

### 2. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è DeployInfrastructureCommand (—ç—Ç–∞–ø 2)

**–§–∞–π–ª:** `clio/Command/DeployInfrastructureCommand.cs`

#### –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```csharp
[Option("force", Required = false, Default = false,
    HelpText = "Force recreation of namespace without prompting if it already exists")]
public bool Force { get; set; }
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ –º–µ—Ç–æ–¥ Execute():
- –®–∞–≥ [1/5]: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è namespace –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- –ï—Å–ª–∏ namespace —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
  - –ü—Ä–∏ —Ñ–ª–∞–≥–µ `--force` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –±–µ–∑ –≤–æ–ø—Ä–æ—Å–æ–≤
  - –ò–Ω–∞—á–µ - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  - –ñ–¥–µ—Ç –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è namespace (–º–∞–∫—Å–∏–º—É–º 10 –ø–æ–ø—ã—Ç–æ–∫ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 2 —Å–µ–∫)

#### –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- `CheckAndHandleExistingNamespace()` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `DeleteExistingNamespace()` - —É–¥–∞–ª–µ–Ω–∏–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –æ–∂–∏–¥–∞–Ω–∏–µ–º

#### –û–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–æ–º–µ—Ä–∞ —à–∞–≥–æ–≤:
- –ò–∑–º–µ–Ω–µ–Ω—ã —Å [1/4] –Ω–∞ [1/5] –¥–ª—è –≤—Å–µ—Ö —à–∞–≥–æ–≤

---

### 3. –°–æ–∑–¥–∞–Ω–∏–µ DeleteInfrastructureCommand (—ç—Ç–∞–ø 3)

**–§–∞–π–ª:** `clio/Command/DeployInfrastructureCommand.cs` (–≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞)

#### –ù–æ–≤—ã–π –∫–ª–∞—Å—Å –æ–ø—Ü–∏–π:
```csharp
[Verb("delete-infrastructure", Aliases = new[] { "di-delete", "remove-infrastructure" },
    HelpText = "Delete Kubernetes infrastructure for Creatio")]
public class DeleteInfrastructureOptions
{
    [Option("force", Required = false, Default = false,
        HelpText = "Skip confirmation and delete immediately")]
    public bool Force { get; set; }
}
```

#### –ù–æ–≤—ã–π –∫–ª–∞—Å—Å –∫–æ–º–∞–Ω–¥—ã:
- –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `Command<DeleteInfrastructureOptions>`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ namespace
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω–µ --force)
- –£–¥–∞–ª—è–µ—Ç namespace —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–¥–æ 15 –ø–æ–ø—ã—Ç–æ–∫)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- –ï—Å–ª–∏ namespace –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –≤—ã—Ö–æ–¥ —Å –∫–æ–¥–æ–º 0
- –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - —É–¥–∞–ª–µ–Ω–∏–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

---

### 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ (—ç—Ç–∞–ø 4)

**–§–∞–π–ª 1:** `clio/BindingsModule.cs`
```csharp
containerBuilder.RegisterType<DeleteInfrastructureCommand>();
```

**–§–∞–π–ª 2:** `clio/Program.cs`
- –î–æ–±–∞–≤–ª–µ–Ω `typeof(DeleteInfrastructureOptions)` –≤ –º–∞—Å—Å–∏–≤ `CommandOption`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ switch –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ `ExecuteCommandWithOption`:
```csharp
DeleteInfrastructureOptions opts => Resolve<DeleteInfrastructureCommand>().Execute(opts),
```

---

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—ç—Ç–∞–ø 5)

**–§–∞–π–ª:** `clio/Commands.md`

‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª `deploy-infrastructure`:
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ namespace
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å `--force` —Ñ–ª–∞–≥–æ–º
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–æ–º–µ—Ä–∞ —à–∞–≥–æ–≤ —Å [1/4] –Ω–∞ [1/5]
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞ —Å –Ω–æ–≤—ã–º —à–∞–≥–æ–º [1/5]
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ–ø—Ü–∏–π

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª `delete-infrastructure`:
- –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (—Å/–±–µ–∑ --force)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
- –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã
- Troubleshooting —Ä–∞–∑–¥–µ–ª
- –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –æ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

‚úÖ **–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –≤ Debug –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- –í—Å–µ warnings —ç—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–¥–µ
- NuGet –ø–∞–∫–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: `clio.8.0.1.72.nupkg`

---

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ö–æ–º–∞–Ω–¥–∞ `deploy-infrastructure`:
```bash
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)
clio deploy-infrastructure

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –±–µ–∑ –≤–æ–ø—Ä–æ—Å–æ–≤
clio deploy-infrastructure --force

# –° –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –ø—É—Ç–µ–º
clio deploy-infrastructure --path /custom/path

# –ë–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
clio deploy-infrastructure --no-verify

# –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –æ–ø—Ü–∏–π
clio deploy-infrastructure --force --no-verify
```

### –ö–æ–º–∞–Ω–¥–∞ `delete-infrastructure`:
```bash
# –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
clio delete-infrastructure

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
clio delete-infrastructure --force

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
clio di-delete
clio remove-infrastructure
```

---

## üìä –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ —Ñ–∞–π–ª–∞–º

| –§–∞–π–ª | –¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|---------------|---------|
| `clio/Common/K8/k8Commands.cs` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ | –î–≤–∞ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é |
| `clio/Command/DeployInfrastructureCommand.cs` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä --force, –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ |
| `clio/BindingsModule.cs` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è DeleteInfrastructureCommand –≤ DI |
| `clio/Program.cs` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã –≤ –ø–∞—Ä—Å–µ—Ä–µ CommandLine |
| `clio/Commands.md` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –æ–±–µ–∏—Ö –∫–æ–º–∞–Ω–¥ |

---

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–æ —Å --force)

2. **Robustness**: –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è namespace –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º

3. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°–ª–µ–¥—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–º—É –ø–∞—Ç—Ç–µ—Ä–Ω—É –ø—Ä–æ–µ–∫—Ç–∞

5. **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é**: –í—Å–µ –º–µ—Ç–æ–¥—ã –Ω–∞–ø–∏—Å–∞–Ω—ã —Å —É—á–µ—Ç–æ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üîç –ì–æ—Ç–æ–≤–æ –∫ —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–∞–º

- ‚úÖ –ù–∞–ø–∏—Å–∞–Ω–∏–µ —é–Ω–∏—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Code review
- ‚úÖ Merge –≤ master

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 4 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –ø–µ—Ä–µ–¥–∞—á–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
