# Создание окружения разработки для macOS

## Описание задачи

Требуется создать единую интегрированную команду, которая автоматизирует полный процесс развертывания локального окружения разработки Creatio на macOS. Команда должна выполнить последовательность операций для инициализации, конфигурации и подготовки приложения к разработке.

## Исходные данные
- ZIP-архив с приложением Creatio на .NET 8
- PostgreSQL база данных
- Kubernetes для оркестрации инфраструктуры

## Основные этапы выполнения

### 1. **Подготовка и распаковка архива**
- Распаковать ZIP-файл в указанную директорию
- Если директория не задана, использовать текущую директорию
- Создать папку с именем `environment` для размещения файлов

### 2. **Создание инфраструктуры**
- Проверить, существует ли уже инфраструктура в Kubernetes
  - Если инфраструктура существует → **пропустить этот шаг**
  - Если инфраструктура отсутствует → развернуть
- Выполнить команду: `clio create infrastructure` с флагом `--auto-deploy`
- Развернуть необходимые сервисы через kubectl (Redis, pgAdmin, PostgreSQL)
- Настроить подключение к базе данных через `clio rdb`
- Дождаться готовности всех сервисов (health checks)

### 3. **Конфигурация Web-приложения**
- Отредактировать строку подключения (ConnectionString) в конфигурации
- Установить системную настройку **Maintainer** (опционально)
  - Если указан флаг `--maintainer` → установить значение
  - Если пользователь согласен интерактивно → спросить и установить
  - Если пользователь пропустил (нажал Enter без значения) → пропустить этот шаг
- Изменить значение параметра `CookiesSameSiteMode` в файле `Terrasoft.WebHost.dll.config` на `Lax`

### 4. **Установка компонентов**
- Установить cliogate через команду `clio gate`
- Зарегистрировать окружение в clio через команду `clio cfg`
- Активировать режим разработки (CDP): `clio cdp true`
- Включить File Design Mode: `clio fsm on`

### 5. **Интерактивные параметры**
- **Environment Name** (env_name) - спросить первым, после инициализации (обязательный параметр)
- **Maintainer** - спросить вторым, если не указан в параметрах (опциональный параметр, можно пропустить нажатием Enter)
- **Port Number** - использовать значение по умолчанию или позволить переопределить
- **Credentials** - использовать значения по умолчанию (Supervisor/Supervisor) или позволить переопределить

## Примеры использования команды

### Пример 1: Минимальные параметры (все интерактивно)
```bash
clio create-dev-env --zip ~/Downloads/creatio-application.zip
# Система запросит:
# 1. Environment Name: my-dev-env
# 2. Maintainer: John Doe
```

### Пример 2: Полная спецификация параметров
```bash
clio create-dev-env \
  --zip ~/Downloads/creatio-application.zip \
  --target-dir ~/projects/creatio-env \
  --env-name development \
  --maintainer "John Doe" \
  --port 8080 \
  --username Supervisor \
  --password Supervisor
```

### Пример 3: С уже существующей директорией
```bash
clio create-dev-env \
  --zip ~/Downloads/creatio-app.zip \
  --target-dir ~/existing-project \
  --env-name prod-dev \
  --maintainer "Admin User"
```

### Пример 4: Использование текущей директории (создаст папку environment)
```bash
cd ~/projects/my-creatio
clio create-dev-env --zip ~/Downloads/creatio-application.zip --env-name local-dev
```

### Пример 5: С альтернативными учетными данными
```bash
clio create-dev-env \
  --zip ~/Downloads/creatio-application.zip \
  --env-name staging \
  --maintainer "Dev Team" \
  --port 443 \
  --username CustomAdmin \
  --password CustomPassword123
```

## Параметры команды

| Параметр | Флаг | Тип | Обязательный | Описание |
|----------|------|-----|--------------|----------|
| ZIP-файл | `--zip` | string | Да | Путь к ZIP-архиву с приложением Creatio |
| Целевая директория | `--target-dir` | string | Нет | Директория для развертывания (по умолчанию: текущая) |
| Имя окружения | `--env-name` | string | Нет | Имя окружения (спросит интерактивно, если не указано) |
| Maintainer | `--maintainer` | string | Нет | Системная настройка Maintainer (опционально, спросит интерактивно если не указано) |
| Порт | `--port` | int | Нет | Порт приложения (по умолчанию: 8080) |
| Имя пользователя | `--username` | string | Нет | Учетные данные (по умолчанию: Supervisor) |
| Пароль | `--password` | string | Нет | Пароль (по умолчанию: Supervisor) |
| Пропустить инфраструктуру | `--skip-infra` | bool | Нет | Пропустить создание инфраструктуры (если она уже существует) |
| Пропустить подтверждение | `--no-confirm` | bool | Нет | Не запрашивать подтверждение перед выполнением |

## Ожидаемый результат

После успешного выполнения команды:
- ✅ Приложение Creatio развернуто в целевой директории
- ✅ Инфраструктура (Redis, PostgreSQL, pgAdmin) запущена и готова (если не существовала или не была пропущена)
- ✅ База данных инициализирована
- ✅ Параметр `Maintainer` установлен в системе (если был указан или пользователь согласился)
- ✅ cliogate установлена и настроена
- ✅ Окружение зарегистрировано в clio
- ✅ CDP режим активирован
- ✅ File Design Mode включен
- ✅ Готово к локальной разработке

## Обработка ошибок

Команда должна предоставлять информативные сообщения об ошибках на каждом этапе с возможностью:
- Отката к предыдущему состоянию при критических ошибках
- Пропуска некритических ошибок с предупреждением
- Логирования всех операций